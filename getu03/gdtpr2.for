C PRIPRAVA 2 - FORMOVANI PROMENNE TEST A KRITICKE HODNOTY CALFA
C=======================================================================
C         1. VERZE  /ZARI 1984/         VUGTK
C       * 5. VERZE      /ZARI 1989/             VUGTK      ALES CEPEK
C
      SUBROUTINE GDTPR2(TEST,CALFA)
C
$INCLUDE: 'GDTSOW.COM'
      CHARACTER*(*) RET
      PARAMETER  (RET='TEST OPRAV:')
      LOGICAL  TEST
      REAL  CALFA,ALFPUL,MTSTU1,TAPN1,V1
      DOUBLE PRECISION  MTNORA
      INTEGER*1  STEST(8),TEXT(38),T60(60)
      EQUIVALENCE (TEXT,T60)
      CHARACTER*60 CT60
      EQUIVALENCE (CT60,T60)
      INTEGER  I
58    FORMAT(/' M0'':',E12.5,' [MM/CC]')
59    FORMAT(/' POCET NADBYTECNYCH POZOROVANI:',I2,
     /'     TEST OPRAV NELZE PROVEST')
60    FORMAT(' MAX. ',8A1,' OPRAVA V''=',F7.2,1X,38A1)
61    FORMAT('    NEPRESAHUJE KRITICKOU HODNOTU',F7.2,' NA HLADINE',
     /F6.2,'%',2X)
611   FORMAT(80A1)
C
      IF(NADBPO.LE.0)  GOTO 9999
      ALFPUL = (1E2-PRST)/2E2
0103  IF(TYPM0(1).NE.'A')  GOTO 0104
         CALFA = MTNORA(DBLE(ALFPUL))
         GOTO 0199
0104  CONTINUE
         IF(NADBPO.LE.1)  GOTO 9999
0303     IF(M01.NE.0)  GOTO 0399
            WRITE(ITT,58)  M01
            WRITE(ITT,59)  NADBPO
0399     CONTINUE
         TAPN1 = MTSTU1(ALFPUL,NADBPO-1)**2
         CALFA = SQRT(NADBPO*TAPN1/((NADBPO-1)+TAPN1))
0199  CONTINUE
      TEST = .TRUE.
      V1 = SQRT(MAXDLT)/M0AKT
      IF(TYPM0(1).EQ.'A')  CALL PPMOV1(1,'NORMOV. ',1,STEST,1,8)
      IF(TYPM0(1).NE.'A')  CALL PPMOV1(1,'STUDENT.',1,STEST,1,8)
      CALL PPMOV1(
     / 1,'(DELKA 1234567890123--> 1234567890123)',1,TEXT,1,38)
      IF(TYPP(INDELT).EQ.'S')  CALL PPMOV1(1,'SMER ',1,TEXT,2,5)
      CALL GDTEXT(CST(INDELT),TEXT( 8))
      CALL GDTEXT(CCI(INDELT),TEXT(25))
      CALL GDSMEZ(TEXT,38,I)
      CALL GDSSTR(2,6)
      CALL GDTTHL(GSGDPT,RET)
      CALL GDTTHL(ITT   ,RET)
      WRITE(GSGDPT,60)  STEST,V1,TEXT
      WRITE(ITT   ,60)  STEST,V1,TEXT
C*    ENCODE(60,61,T60)  CALFA,1E2-PRST
      WRITE(CT60,61)     CALFA,1E2-PRST
C*    IF(V1.GT.CALFA)  CALL PPINI1(' ',2,T60(5))
      IF(V1.GT.CALFA) THEN
         T60(5) = ' '
	 T60(6) = ' '
      END IF
      CALL GDSMEZ(T60,60,I)
      WRITE(GSGDPT,611)  T60
      WRITE(ITT   ,611)  T60
      RETURN
C
9999  TEST = .FALSE.
      CALL GDSSTR(2,0)
      WRITE(GSGDPT,59)  NADBPO
      WRITE(ITT   ,59)  NADBPO
      RETURN
C
      END
